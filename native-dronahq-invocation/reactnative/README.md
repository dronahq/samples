# React Native Sample

Please check that you have Node.js version >= 4.0 before starting

## Installation
```
install React Native CLI using this command
$ npm install -g react-native-cli

Create new project with
$ react-native init SampleApp
then
$ cd SampleApp

You can now run the app using
$ react-native run-android
(Change android to ios if you want to run the app on ios)
```

## Code
All the necessary files will be created by the init command.
In that App.js file is the entry point of the app

In this sample we will be working with two screens Home.js and Details.js so create a new folder "screens" and create these two files in it.
Now to manage transitions between them create "AppNavigator.js" file in the root directory  as follows

```js
import Home from './screens/Home';
import Details from './screens/Details';

const AppNavigator = createStackNavigator({
    Home: {
        screen: Home,
    },
	Details: {
        screen: Details,
    }
},
{
	initialRouteName: 'Home',
});

export default createAppContainer(AppNavigator);
```

In above code "initialRouteName" is the first screen to open from the whole stack

In App.js remove all the unnecessary code and just return AppNavigator in render function (before that import AppNavigator)
```js
import AppNavigator from './AppNavigator';
```
then
```js
return (
   <AppNavigator/>
);
```

In Home.js we basically receive the deeplinking data and also we can open DronaHQ app with a button

1. To receive data we can use getInitialURL() method of "Linking" package as below.
```js
componentDidMount() {
    Linking.getInitialURL().then(url => {
           this.navigate(url);
    });
}
```
In above code componentDidMount() is called after all the elements of page is loaded correctly.
navigate method navigates to Details.js and passes received data (url) with key "Deep_linking_data"
as follows:
```js
navigate = (url) => {
    if (url != null && url.includes('nativetest')) {
	  this.props.navigation.navigate('Details', {
              Deep_linking_data: url,
            })
    };
  }
```

2. To open other native app we can use canOpenURL() method of the same "Linking" package. 
    Just create openApp() method and call it on the button click
```js
openApp() {
	const url = 'dhq://?scheme=nativetest';
	Linking.canOpenURL(url).then(supported => {
		if (!supported) {
			console.log('Can\'t handle url: ' + url);
		} else {
			return Linking.openURL(url);
		}
	}).catch(err => console.error('An error occurred', err));
  }
```

In Details.js we basically receive the deeplinking data passed from Home.js just to display it as follows:
```html
<Text style={styles.TextStyle}>
          {this.props.navigation.state.params.Deep_linking_data
            ? this.props.navigation.state.params.Deep_linking_data
            : 'No Value Passed'}
</Text>
```
## For IOS
JS side code is same we dont need to handle anything specific to IOS but we have
to add some code in xcode project generated automatically by react native.

You will find xcode project in ios folder generated by react native

ios/ProjectName.xcodeproj

- Open the above mentioned project in xcode and do the following
1. Add code in AppDelegate.m
    -----------------------------------
        #import <React/RCTLinkingManager.h>

        - (BOOL)application:(UIApplication *)application
            openURL:(NSURL *)url
            options:(NSDictionary<UIApplicationOpenURLOptionsKey,id> *)options
            {
                return [RCTLinkingManager application:application openURL:url options:options];
            }
    -----------------------------------

    The use of the code is to receive the payload when called from DronaHQ container app.
    
2. In Info.plist

- Under Info.plist, Under URL Types add new URL scheme. (Add same URL scheme of your choice, make sure it is same as Android App. In this example 'nativetest' is added as URL scheme)
- Add LSApplicationQueriesSchemes as array in your .plist file and add Item0 as string with value ‘dhq’ (Required to launch DronaHQ App from Native App)

3. Add capabilities
- Under Capabilities, Enable Associated Domains and add below 3 domains. (Required to launch Native App from DronaHQ App without user confirmation using Universal Links)

```
    applinks:s0.deeplink.dronahq.com
    applinks:s1.deeplink.dronahq.com
    applinks:s2.deeplink.dronahq.com
```

## Troubleshooting (IOS)
If after running the application using react native run command (on ios) you get
"No url bundle present with main.jsbundle not found" error then run the following command
at the root of the project directory
 
react-native bundle --entry-file index.js --platform ios --dev false --bundle-output ios/ProjectName/main.jsbundle --assets-dest ios

Reference 
 https://stackoverflow.com/questions/49505446/main-jsbundle-does-not-exist-this-must-be-a-bug-with-echo-react-native